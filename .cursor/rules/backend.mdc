---
description: 
globs: 
alwaysApply: true
---
### ðŸ§  backend.mdc

#### Goal:
Define all serverless backend behaviors using Vercel + U^2-Net API (hosted on Replicate or similar). No database, no file storage.

---

#### Core Backend Functions
- `POST /api/remove-bg`
  - Accepts: `multipart/form-data` (only `.jpeg`, `.png`)
  - Validates file size â‰¤ 5MB
  - Forwards image to U^2-Net inference API
  - Returns: processed image blob

---

#### Backend Rules
- âœ… Use `NextResponse.json()` or `NextResponse.blob()` for handling output
- âœ… Stream uploads directly to U^2-Net, do not store locally
- âœ… Use `FormData` for forwarding requests to Replicate
- âœ… Validate file extension and mime-type before processing
- âœ… Rate-limit via middleware (e.g., 10 req/min per IP)

---

#### Error Handling
- Return clear HTTP errors:
  - `400` for bad image
  - `413` for too large
  - `500` if model fails
- Use structured error responses: `{ error: string, statusCode: number }`

---

#### Rule Summary
âœ… Enforced:
- Stateless processing
- Proper validation + error reporting
- Direct piping to model
- Use only supported file formats

ðŸš« Avoid:
- Writing to `/tmp`
- Storing any images
- Uncaught exceptions